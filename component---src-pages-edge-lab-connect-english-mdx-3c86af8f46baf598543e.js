(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{eK2s:function(e,n,t){"use strict";t.r(n),t.d(n,"_frontmatter",(function(){return r})),t.d(n,"default",(function(){return u}));var a=t("vxd2"),o=t("+ZQ4"),i=(t("tbR7"),t("8ZXK")),l=t("ZUrL"),r=(t("GP0y"),{}),c=function(e){return function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(i.b)("div",n)}},s=c("PageDescription"),d=c("InlineNotification"),p=c("Accordion"),b=c("AccordionItem"),m={_frontmatter:r},g=l.a;function u(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(i.b)(g,Object(a.a)({},m,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)(s,{mdxType:"PageDescription"},Object(i.b)("p",null,"In this section you will setup your target environment in which you will deploy the sample application and the edge agent.\nIf you want to bring your own environemt, feel free to do so.")),Object(i.b)("h2",null,"Agent Installation and Registration"),Object(i.b)("p",null,"In this lab we will use the automated agent installation and registration method. Other option are"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Advanced manual agent installation and registration "),Object(i.b)("li",{parentName:"ul"},"Bulk agent installation and registration"),Object(i.b)("li",{parentName:"ul"},"Secure Device Onboarding (SDO) agent installation and registration")),Object(i.b)(d,{kind:"info",mdxType:"InlineNotification"},Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," These steps are the same for all edge device types (architectures).")),Object(i.b)("p",null,"If you have not already perpared your device with the steps in ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/think-labs/edge-lab/requirements/english"}),"Requirements")," section, do that now."),Object(i.b)("p",null,"The IBM Edge Application Manager should not list any or your device as shown below\n",Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"../images/IEAM-nonode.png",alt:"IEAM-nonode"}))),Object(i.b)("p",null,"1) Set the following environment variables on your device."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"export HZN_DEVICE_ID=<yourname>\nexport HZN_EXCHANGE_USER_AUTH=iamapikey:<api-key>\nexport HZN_ORG_ID=<your-exchange-organization>\nexport HZN_FSS_CSSURL=https://<ieam-management-hub-ingress>/edge-css/\nexport HNZ_EXCHANGE_URL=https://<ieam-management-hub-ingress>/edge-exchange/v1\n")),Object(i.b)(d,{kind:"info",mdxType:"InlineNotification"},Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," we have already prepared the environment to ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.ibm.com/docs/en/edge-computing/4.2?topic=installation-prepare-setting-up-edge-nodes"}),"setup edge nodes"),", where we created the apikey and organisation for you.")),Object(i.b)("p",null,"2) For the automated installation download the agent-install.sh script from the Cloud Sync Service (CSS) to your device and make it executable:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'curl -u "$HZN_ORG_ID/$HZN_EXCHANGE_USER_AUTH" -k -o agent-install.sh $HZN_FSS_CSSURL/api/v1/objects/IBM/agent_files/agent-install.sh/data\nchmod +x agent-install.sh\n')),Object(i.b)("p",null,"3) Run agent-install.sh to get the necessary files from CSS, install and configure the Horizon agent, and register your edge device to run the helloworld sample edge service:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo -s -E ./agent-install.sh -i 'css:' -p IBM/pattern-ibm.helloworld -w '*' -T 120\n")),Object(i.b)(d,{kind:"info",mdxType:"InlineNotification"},Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," To see all available agent-install.sh flag descriptions run: ",Object(i.b)("inlineCode",{parentName:"p"},"./agent-install.sh -h"))),Object(i.b)(p,{mdxType:"Accordion"},Object(i.b)(b,{title:"agent-install output",mdxType:"AccordionItem"},Object(i.b)("p",null,"You shoud see the following cli output for a successful installation. Depending on your device and connection this will take some time."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"$ curl -u \"$HZN_ORG_ID/$HZN_EXCHANGE_USER_AUTH\" -k -o agent-install.sh $HZN_FSS_CSSURL/api/v1/objects/IBM/agent_files/agent-install.sh/data\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100  113k    0  113k    0     0  76924      0 --:--:--  0:00:01 --:--:-- 76924\n$ chmod +x agent-install.sh\n$ sudo -s -E ./agent-install.sh -i 'css:' -p IBM/pattern-ibm.helloworld -w '*' -T 120\n2021-04-27 12:12:57 AGENT_INSTALL_ZIP:  (from default value)\n2021-04-27 12:12:58 INPUT_FILE_PATH: css: (from command line flag)\n2021-04-27 12:12:58 INPUT_FILE_PATH adjusted to: css:/api/v1/objects/IBM/agent_files\n2021-04-27 12:12:58 AGENT_CFG_FILE:  (from default value)\n2021-04-27 12:12:58 AGENT_VERBOSITY: 3 (from environment variable)\n2021-04-27 12:12:58 HZN_ORG_ID: thinkedge (from environment variable)\n2021-04-27 12:12:58 HZN_MGMT_HUB_CERT_PATH:  (from default value)\n2021-04-27 12:12:58 AGENT_CERT_FILE: agent-install.crt (from default value)\n2021-04-27 12:12:58 HZN_FSS_CSSURL: https://cp-console.edge-lab-2172-think21-6a6ac8c3d7a0ea50590dce8fa3fd273c-0000.us-south.containers.appdomain.cloud/edge-css (from environment variable)\n2021-04-27 12:12:58 HZN_EXCHANGE_USER_AUTH: ****** (from environment variable)\n2021-04-27 12:12:58 HZN_EXCHANGE_NODE_AUTH:  (from default value)\n2021-04-27 12:12:58 Downloading file https://cp-console.edge-lab-2172-think21-6a6ac8c3d7a0ea50590dce8fa3fd273c-0000.us-south.containers.appdomain.cloud/edge-css/api/v1/objects/IBM/agent_files/agent-install.crt/data using --insecure ...\n2021-04-27 12:12:59 Downloading file https://cp-console.edge-lab-2172-think21-6a6ac8c3d7a0ea50590dce8fa3fd273c-0000.us-south.containers.appdomain.cloud/edge-css/api/v1/objects/IBM/agent_files/agent-install.cfg/data ...\n2021-04-27 12:13:00 AGENT_SKIP_REGISTRATION: false (from default value)\n2021-04-27 12:13:00 HZN_EXCHANGE_URL: https://cp-console.edge-lab-2172-think21-6a6ac8c3d7a0ea50590dce8fa3fd273c-0000.us-south.containers.appdomain.cloud/edge-exchange/v1 (from configuration file)\n2021-04-27 12:13:00 NODE_ID:  (from default value)\n2021-04-27 12:13:00 HZN_DEVICE_ID: my-pi (from environment variable)\n2021-04-27 12:13:00 HZN_NODE_ID:  (from default value)\n2021-04-27 12:13:00 HZN_EXCHANGE_PATTERN: IBM/pattern-ibm.helloworld (from command line flag)\n2021-04-27 12:13:00 HZN_NODE_POLICY:  (from default value)\n2021-04-27 12:13:00 AGENT_WAIT_FOR_SERVICE: * (from command line flag)\n2021-04-27 12:13:00 AGENT_WAIT_FOR_SERVICE_ORG:  (from default value)\n2021-04-27 12:13:00 AGENT_REGISTRATION_TIMEOUT: 120 (from command line flag)\n2021-04-27 12:13:00 AGENT_OVERWRITE: false (from default value)\n2021-04-27 12:13:00 AGENT_SKIP_PROMPT: false (from default value)\n2021-04-27 12:13:00 AGENT_INSTALL_ZIP: agent-install-files.tar.gz (from default value)\n2021-04-27 12:13:00 AGENT_DEPLOY_TYPE: device (from default value)\n2021-04-27 12:13:00 AGENT_WAIT_MAX_SECONDS: 30 (from default value)\n2021-04-27 12:13:01 NODE_ID_MAPPING_FILE: node-id-mapping.csv (from default value)\n2021-04-27 12:13:01 PKG_APT_KEY:  (from default value)\n2021-04-27 12:13:01 APT_REPO_BRANCH: updates (from default value)\n2021-04-27 12:13:01 AGENT_IMAGE_TAR_FILE: amd64_anax.tar.gz (from default value)\n2021-04-27 12:13:05 OS: linux, Distro: raspbian, Distro Release: 10, Distro Code Name: buster, Architecture: armhf\n2021-04-27 12:13:05 WARNING: Using node id from HZN_DEVICE_ID\n2021-04-27 12:13:05 Node type: device\n2021-04-27 12:13:05 Updating apt package index...\n2021-04-27 12:14:15 Installing prerequisites, this could take a minute...\n2021-04-27 12:16:17 Verifying that node my-pi in the exchange is type device (if it exists)...\n2021-04-27 12:16:18 Creating /etc/default/horizon ...\n2021-04-27 12:16:19 Downloading file https://cp-console.edge-lab-2172-think21-6a6ac8c3d7a0ea50590dce8fa3fd273c-0000.us-south.containers.appdomain.cloud/edge-css/api/v1/objects/IBM/agent_files/horizon-agent-linux-deb-armhf.tar.gz/data ...\n2021-04-27 12:16:42 Installing the horizon packages in /root/. ...\n2021-04-27 12:18:22 Waiting for state: Horizon agent ready \n2021-04-27 12:18:24 Done: Horizon agent ready\n2021-04-27 12:18:25 Registering the edge node...\nhzn register -m 'make-pi' -o 'thinkedge' -u 'iamapikey:I1qBL7mXekVo-jxJf_3M3th6xEWaPuuYvegbxBZthSoL' -n 'my-pi:' -s '*'  -t '120' -p 'IBM/pattern-ibm.helloworld'\nHorizon Exchange base URL: https://cp-console.edge-lab-2172-think21-6a6ac8c3d7a0ea50590dce8fa3fd273c-0000.us-south.containers.appdomain.cloud/edge-exchange/v1\nGenerated random node token\nNode thinkedge/my-pi does not exist in the Exchange with the specified token, creating/updating it...\nnode added or updated\nNode my-pi created.\nWill proceeed with the given pattern IBM/pattern-ibm.helloworld.\nInitializing the Horizon node with node type 'device'...\nNote: no input file was specified. This is only valid if none of the services need variables set.\nHowever, if there is 'userInput' specified in the node already in the Exchange, the userInput will be used.\nChanging Horizon state to configured to register this node with Horizon...\nHorizon node is registered. Workload services should begin executing shortly.\nWaiting for up to 120 seconds for following services to start:\n    IBM/ibm.helloworld\nStatus of the services you are watching:\n    IBM/ibm.helloworld  Waiting: no agreements formed yet\nStatus of the services you are watching:\n    IBM/ibm.helloworld  Waiting: agreement is formed\nStatus of the services you are watching:\n    IBM/ibm.helloworld  Waiting: agreement is accepted\nStatus of the services you are watching:\n    IBM/ibm.helloworld  Waiting: service is created\nStatus of the services you are watching:\n    IBM/ibm.helloworld  Waiting: service is created\nStatus of the services you are watching:\n    IBM/ibm.helloworld  Waiting: service is created\nTimeout waiting for some services to successfully start. Analyzing possible reasons for the timeout...\n\nCurrently, there are no errors recorded in the node's event log.\nUsing the 'hzn deploycheck all -p' command to verify that node, service configuration and pattern is compatible.\nNeither node id nor node policy is specified. Getting node policy from the local node.\nNeither node id nor node user input file is specified. Getting node user input from the local node.\n{\n  \"compatible\": true,\n  \"reason\": {\n    \"IBM/ibm.helloworld_1.0.0_arm\": \"Compatible\"\n  }\n}\n\nAnalysis complete.\n\n")))),Object(i.b)("p",null,"If you look at the IBM Edge Application Manager UI you will see that your device shows up in the Nodes tab. Finally it should be in the state ",Object(i.b)("strong",{parentName:"p"},"Active with services")," the agent linstallation we have choose also deploys a sample service.\n",Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"../images/IEAM-nodes-chart.png",alt:"IEAM-nodes-chart"}))),Object(i.b)("p",null,"You can switch between the chart and list view\n",Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"../images/IEAM-nodes-list.png",alt:"IEAM-nodes-list"}))),Object(i.b)("p",null,"Select your device to get detailed information about your node\n",Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"../images/IEAM-node-details.png",alt:"IEAM-node-details"}))),Object(i.b)("p",null,"To view the helloworld sample edge service output which is installed as part of the agent-install run"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"hzn service log -f ibm.helloworld\n# Press Ctrl-c to stop the output display\n")),Object(i.b)(p,{mdxType:"Accordion"},Object(i.b)(b,{title:"service output",mdxType:"AccordionItem"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"$ hzn service log -f ibm.helloworld\nDisplaying log messages for service ibm.helloworld with service id 593a50ceadeae6c83f74b63d2591cb87af962472a8c3e4cd18d007d14d78c00e.\nUse ctrl-C to terminate this command.\nApr 27 12:20:40 make-pi workload-593a50ceadeae6c83f74b63d2591cb87af962472a8c3e4cd18d007d14d78c00e_ibm.helloworld[1407]: my-pi says: Hello World!!\nApr 27 12:20:43 make-pi workload-593a50ceadeae6c83f74b63d2591cb87af962472a8c3e4cd18d007d14d78c00e_ibm.helloworld[1407]: my-pi says: Hello World!!\nApr 27 12:20:46 make-pi workload-593a50ceadeae6c83f74b63d2591cb87af962472a8c3e4cd18d007d14d78c00e_ibm.helloworld[1407]: my-pi says: Hello World!!\nApr 27 12:20:49 make-pi workload-593a50ceadeae6c83f74b63d2591cb87af962472a8c3e4cd18d007d14d78c00e_ibm.helloworld[1407]: my-pi says: Hello World!!\nApr 27 12:20:52 make-pi workload-593a50ceadeae6c83f74b63d2591cb87af962472a8c3e4cd18d007d14d78c00e_ibm.helloworld[1407]: my-pi says: Hello World!!\nApr 27 12:20:55 make-pi workload-593a50ceadeae6c83f74b63d2591cb87af962472a8c3e4cd18d007d14d78c00e_ibm.helloworld[1407]: my-pi says: Hello World!!\nApr 27 12:20:58 make-pi workload-593a50ceadeae6c83f74b63d2591cb87af962472a8c3e4cd18d007d14d78c00e_ibm.helloworld[1407]: my-pi says: Hello World!!\n")))),Object(i.b)("p",null,"If the helloworld edge service does not start, run this command to see error messages:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"hzn eventlog list -f\n# Press Ctrl-c to stop the output display\n")),Object(i.b)(p,{mdxType:"Accordion"},Object(i.b)(b,{title:"eventlog output",mdxType:"AccordionItem"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'$ hzn eventlog list -f\n  "2021-04-27 12:18:30:   Start node configuration/registration for node my-pi.",\n  "2021-04-27 12:18:36:   Start service auto configuration for IBM/ibm.helloworld.",\n  "2021-04-27 12:18:36:   Complete service auto configuration for IBM/ibm.helloworld.",\n  "2021-04-27 12:18:37:   Complete node configuration/registration for node my-pi.",\n  "2021-04-27 12:18:37:   Start policy advertising with the Exchange for service IBM/ibm.helloworld.",\n  "2021-04-27 12:18:38:   Complete policy advertising with the Exchange for service IBM/ibm.helloworld.",\n  "2021-04-27 12:19:42:   Node received Proposal message using agreement 593a50ceadeae6c83f74b63d2591cb87af962472a8c3e4cd18d007d14d78c00e for service IBM/ibm.helloworld from the agbot IBM/agbot.",\n  "2021-04-27 12:19:47:   Node received Proposal message using agreement 66ed9bb65e4405db0f3904d0e8443c7b80c9067f56db9220f2715cb53efd03d3 for service IBM/ibm.helloworld from the agbot IBM/agbot.",\n  "2021-04-27 12:19:48:   Agreement 593a50ceadeae6c83f74b63d2591cb87af962472a8c3e4cd18d007d14d78c00e already exists, ignoring proposal: ibm.helloworld",\n  "2021-04-27 12:19:55:   Agreement reached for service ibm.helloworld. The agreement id is 593a50ceadeae6c83f74b63d2591cb87af962472a8c3e4cd18d007d14d78c00e.",\n  "2021-04-27 12:19:56:   Start dependent services for IBM/ibm.helloworld.",\n  "2021-04-27 12:19:56:   Start workload service for IBM/ibm.helloworld.",\n  "2021-04-27 12:20:22:   Image loaded for IBM/ibm.helloworld.",\n  "2021-04-27 12:20:41:   Workload service containers for IBM/ibm.helloworld are up and running."\n')))),Object(i.b)("p",null,"(optional) Use the hzn command on this edge node to view services, patterns, and deployment policies in the Horizon Exchange. Set your specific information as environment variables in your shell and run these commands:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"eval export $(cat agent-install.cfg)\nhzn exchange service list IBM/\nhzn exchange pattern list IBM/\nhzn exchange deployment listpolicy\n")),Object(i.b)("p",null,"Explore all of the hzn command flags and subcommands:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"hzn --help\n")),Object(i.b)("p",null,"Finally run the following command to unregister the device again and remove the sample edge service"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"hzn unregister -f\n")),Object(i.b)(p,{mdxType:"Accordion"},Object(i.b)(b,{title:"unregister output",mdxType:"AccordionItem"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"$ hzn unregister -f\nUnregistering this node, cancelling all agreements, stopping all workloads, and restarting Horizon...\nWaiting for Horizon node unregister to complete: No Timeout specified ...\nWaiting for agent service to restart and checking the node configuration state...\nHorizon node unregistered. You may now run 'hzn register ...' again, if desired.\n")))),Object(i.b)("p",null,"Your device should show up in IBM Edge Application Manager UI node view in unregistered state.\n",Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"../images/IEAM-node-unregistered.png",alt:"IEAM-node-unregistered"}))),Object(i.b)("p",null,"Your are now ready to start developing your first edge service"))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-edge-lab-connect-english-mdx-3c86af8f46baf598543e.js.map