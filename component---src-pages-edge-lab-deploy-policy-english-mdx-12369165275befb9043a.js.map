{"version":3,"sources":["webpack:///../instana-lab/src/pages/edge-lab/deploy-policy/english.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","PageDescription","InlineNotification","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","kind","isMDXComponent"],"mappings":"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","file":"component---src-pages-edge-lab-deploy-policy-english-mdx-12369165275befb9043a.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/mkeppel/Documents/GitHub/instana-lab/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst PageDescription = makeShortcode(\"PageDescription\");\nconst InlineNotification = makeShortcode(\"InlineNotification\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <PageDescription mdxType=\"PageDescription\">\n      <p>{`In this section you will deploy the edge service that you created in a previous step to your edge environment.`}</p>\n    </PageDescription>\n    <h2>{`Deploying an edge service with a deployment policy`}</h2>\n    <h3>{`Preconditions for deploying your own service`}</h3>\n    <p>{`  If you have not already done do, complete the section `}<a parentName=\"p\" {...{\n        \"href\": \"../service/english\"\n      }}>{`Create an Edge Service`}</a></p>\n    <h3>{`Using the edge service with deployment policy`}</h3>\n    <p>{`The Horizon Policy mechanism offers an alternative to using Deployment Patterns. Policies provide much finer control over the deployment placement of edge services. It also provides a greater separation of concerns, allowing Edge Nodes owners, Service code developers, and Business owners to each independently articulate their own Policies. There are therefore three types of Horizon Policies:`}</p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Node Policy (provided at registration time by the node owner)`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Service Policy (may be applied to a published Service in the Exchange)`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Deployment Policy (which approximately corresponds to a Deployment Pattern)`}</p>\n      </li>\n    </ol>\n    <h2>{`Node Policy`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`As an alternative to specifying a Deployment Pattern when you register your Edge Node, you may register with a Node Policy.`}</li>\n    </ul>\n    <ol>\n      <li parentName=\"ol\">{`Get the required helloworld node policy file:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`wget https://raw.githubusercontent.com/open-horizon/examples/master/edge/services/helloworld/horizon/node.policy.json\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Below is the node.policy.json file you obtained in step one:`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{}}>{`{\n  \"properties\": [\n    { \"name\": \"openhorizon.example\", \"value\": \"hello-$USER_ID\" }\n  ],\n  \"constraints\": [\n  ]\n}\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`It provides values for one just properties (openhorizon.example), change the value to `}<strong parentName=\"li\">{`hello-$USER_ID`}</strong>{` this should restrict the services that get deployed to this edge node to your hello service.`}</li>\n    </ul>\n    <ol {...{\n      \"start\": 2\n    }}>\n      <li parentName=\"ol\">{`Register your Node Policy with this policy`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`hzn register --policy node.policy.json\n`}</code></pre>\n    <ol {...{\n      \"start\": 3\n    }}>\n      <li parentName=\"ol\">{`When the registration completes, use the following command to review the Node Policy:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`hzn policy list\n`}</code></pre>\n    <InlineNotification kind=\"info\" mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Notice`}</strong>{` that in addition to the three properties stated in the node_policy.json file, Horizon has added a few more (openhorizon.cpu, openhorizon.arch, and openhorizon.memory). Horizon provides this additional information automatically and these properties may be used in any of your Policy constraints.`}</p>\n    </InlineNotification>\n    <p>{`Your device should now also be visible in `}<strong parentName=\"p\">{`Active without services`}</strong>{` in the IBM Edge Application Manager UI\n`}<img parentName=\"p\" {...{\n        \"src\": \"../images/IEAM-node-active.png\",\n        \"alt\": \"IEAM-node-active\"\n      }}></img></p>\n    <h2>{`Service Policy`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`Like the other two Policy types, Service Policy contains a set of properties and a set of constraints. The properties of a Service Policy could state characteristics of the Service code that Node Policy authors or Deployment Policy authors may find relevant. The constraints of a Service Policy can be used to restrict where this Service can be run. The Service developer could, for example, assert that this Service requires a particular hardware setup such as CPU/GPU constraints, memory constraints, specific sensors, actuators or other peripheral devices required, etc.`}</li>\n      <li parentName=\"ul\">{`Below is the `}<strong parentName=\"li\">{`service.policy.json`}</strong>{` file that was created as part of your service creation in the horizon directory:`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{}}>{`{\n    \"properties\": [\n        {\n            \"name\": \"prop1\",\n            \"value\": \"value1\"\n        }\n    ],\n    \"constraints\": []\n}\n`}</code></pre>\n    <ol>\n      <li parentName=\"ol\">{`View the pubished service policy attached to your service:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`hzn exchange service listpolicy \\${HZN_ORG_ID}/hello-\\${USER_ID}_0.0.1_$(hzn architecture)\n`}</code></pre>\n    <InlineNotification kind=\"info\" mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Notice`}</strong>{` that the generated service policy is not automatically added to your Service at publishing time.`}</p>\n    </InlineNotification>\n    <ol {...{\n      \"start\": 2\n    }}>\n      <li parentName=\"ol\">{`Create a `}<strong parentName=\"li\">{`service.policy.json`}</strong>{` file with the content below`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`{\n  \"properties\": [\n  ],\n  \"constraints\": [\n    \"openhorizon.memory >= 100\"\n  ]\n}\n`}</code></pre>\n    <InlineNotification kind=\"info\" mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Note`}</strong>{` this simple Service Policy doesn’t provide any properties, but it does have a constraint. This example constraint is one that a Service developer might add, stating that their Service must only run on edge nodes with 100 MB or more memory.`}</p>\n    </InlineNotification>\n    <InlineNotification kind=\"info\" mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Notice`}</strong>{` that Horizon has again automatically added some additional properties to your Policy. These generated property values can be used in constraints in Node Policies and Deployment Policies.`}</p>\n    </InlineNotification>\n    <ol {...{\n      \"start\": 3\n    }}>\n      <li parentName=\"ol\">{`Update the service.policies attached to you service`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`hzn exchange service addpolicy -f service.policy.json \\${HZN_ORG_ID}/hello-\\${USER_ID}_0.0.1_$(hzn architecture)\n`}</code></pre>\n    <ol {...{\n      \"start\": 4\n    }}>\n      <li parentName=\"ol\">{`View the pubished updates to the service policy attached to your service:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`hzn exchange service listpolicy \\${HZN_ORG_ID}/hello-\\${USER_ID}_0.0.1_$(hzn architecture)\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Now that you have set up the Policy for your Edge Node and the published Service policy is in the exchange, we can move on to the final step of defining a Deployment Policy to tie them all together and cause software to be automatically deployed on your Edge Node.`}</li>\n    </ul>\n    <h2>{`Deployment Policy`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`Deployment Policy is what ties together Edge Nodes, Published Services, and the Policies defined for each of those, making it roughly analogous to the Deployment Patterns you have previously worked with.`}</li>\n      <li parentName=\"ul\">{`Deployment Policy, like the other two Policy types, contains a set of properties and a set of constraints, but it contains other things as well. For example, it explicitly identifies the Service it will cause to be deployed onto Edge Nodes if negotiation is successful, in addition to configuration variable values, performing the equivalent function to the -f horizon/userinput.json clause of a Deployment Pattern hzn register … command. The Deployment Policy approach for configuration values is more powerful because this operation can be performed centrally (no need to connect directly to the Edge Node).`}</li>\n    </ul>\n    <ol>\n      <li parentName=\"ol\">{`Create a `}<strong parentName=\"li\">{`deployment.policy.json`}</strong>{` file with the content below for your service:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`{\n  \"label\": \"$SERVICE_NAME Deployment Policy\",\n  \"description\": \"A super-simple sample Horizon Deployment Policy\",\n  \"service\": {\n    \"name\": \"$SERVICE_NAME\",\n    \"org\": \"$HZN_ORG_ID\",\n    \"arch\": \"*\",\n    \"serviceVersions\": [\n      {\n        \"version\": \"$SERVICE_VERSION\",\n        \"priority\":{}\n      }\n    ]\n  },\n  \"properties\": [\n  ],\n  \"constraints\": [\n    \"openhorizon.example == hello-$USER_ID\"\n  ],\n  \"userInput\": [\n    {\n      \"serviceOrgid\": \"$HZN_ORG_ID\",\n      \"serviceUrl\": \"$SERVICE_NAME\",\n      \"serviceVersionRange\": \"[0.0.0,INFINITY)\",\n      \"inputs\": [\n        {\n          \"name\": \"HW_WHO\",\n          \"value\": \"Valued Customer\"\n        }\n      ]\n    }\n  ]\n}\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`This simple example of a Deployment Policy doesn’t provide any properties, but it does have one constraints value that is satisfied by the properties set in the node.policy.json file, so this Deployment Policy should successfully deploy our Service onto the Edge Node.`}</li>\n      <li parentName=\"ul\">{`At the end, the userInput section has the same purpose as the horizon/userinput.json files provided for other examples if the given services requires them. In this case the helloworld service defines only one configuration variable, HW_WHO, and the userInput section here provides a value for HW_WHO (i.e., Valued Customer).`}</li>\n    </ul>\n    <ol>\n      <li parentName=\"ol\">{`Publish and view your deployment policy in the Horizon Exchange:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`hzn exchange deployment addpolicy -f deployment.policy.json \\${HZN_ORG_ID}/policy-hello-\\${USER_ID}_0.0.1\nhzn exchange deployment listpolicy \\${HZN_ORG_ID}/policy-hello-\\${USER_ID}_0.0.1\n`}</code></pre>\n    <ol {...{\n      \"start\": 2\n    }}>\n      <li parentName=\"ol\">{`By now your edge device should have formed an agreement with one of the Horizon agreement bots (this typically takes about 15 seconds). Repeatedly query the agreements of this device until the agreement_finalized_time and agreement_execution_start_time fields are filled in:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`hzn agreement list\n`}</code></pre>\n    <ol {...{\n      \"start\": 3\n    }}>\n      <li parentName=\"ol\">{`After the agreement is made, list the edge service docker container that has been started as a result:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`sudo docker ps\n`}</code></pre>\n    <ol {...{\n      \"start\": 4\n    }}>\n      <li parentName=\"ol\">{`See the helloworld service output:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`sudo hzn service log -f hello-$USER_ID\n`}</code></pre>\n    <InlineNotification kind=\"info\" mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Note:`}</strong>{` Press Ctrl C to stop the command output.`}</p>\n    </InlineNotification>\n    <p>{`Again look in the IBM Edge Application Manager UI, your device should show the state `}<strong parentName=\"p\">{`Active with servies`}</strong>{`\n`}<img parentName=\"p\" {...{\n        \"src\": \"../images/IEAM-node-active-service.png\",\n        \"alt\": \"IEAM-node-active-service\"\n      }}></img></p>\n    <ol {...{\n      \"start\": 5\n    }}>\n      <li parentName=\"ol\">{`Unregister your edge node:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`hzn unregister -f\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}